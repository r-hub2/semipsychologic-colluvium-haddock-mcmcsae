<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Basic area-level model</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Basic area-level model</h1>



<p>The basic area-level model <span class="citation">(Fay and Herriot
1979; Rao and Molina 2015)</span> is given by <span class="math display">\[
y_i | \theta_i \stackrel{\mathrm{iid}}{\sim} {\cal N} (\theta_i, \psi_i)
\,, \\
\theta_i = \beta&#39; x_i  + v_i \,,
\]</span> where <span class="math inline">\(i\)</span> runs from 1 to
<span class="math inline">\(m\)</span>, the number of areas, <span class="math inline">\(\beta\)</span> is a vector of regression
coefficients for given covariates <span class="math inline">\(x_i\)</span>, and <span class="math inline">\(v_i
\stackrel{\mathrm{iid}}{\sim} {\cal N} (0, \sigma_v^2)\)</span> are
independent random area effects. For each area an observation <span class="math inline">\(y_i\)</span> is available with given variance
<span class="math inline">\(\psi_i\)</span>.</p>
<p>First we generate some data according to this model:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">75</span><span class="dt">L</span>  <span class="co"># number of areas</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">area=</span><span class="dv">1</span><span class="sc">:</span>m,      <span class="co"># area indicator</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">runif</span>(m)     <span class="co"># covariate</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(m, <span class="at">sd=</span><span class="fl">0.5</span>)    <span class="co"># true area effects</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>df<span class="sc">$</span>x <span class="sc">+</span> v  <span class="co"># quantity of interest</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">runif</span>(m, <span class="fl">0.5</span>, <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, m, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="co"># given variances</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>df<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(m, theta, <span class="fu">sqrt</span>(psi))</span></code></pre></div>
<p>A sampler function for a model with a regression component and a
random intercept is created by</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(mcmcsae)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="fu">reg</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x, <span class="at">name=</span><span class="st">&quot;beta&quot;</span>) <span class="sc">+</span> <span class="fu">gen</span>(<span class="at">factor =</span> <span class="sc">~</span><span class="fu">iid</span>(area), <span class="at">name=</span><span class="st">&quot;v&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>sampler <span class="ot">&lt;-</span> <span class="fu">create_sampler</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  model,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">family=</span><span class="fu">f_gaussian</span>(<span class="at">var.prior=</span><span class="fu">pr_fixed</span>(<span class="dv">1</span>), <span class="at">var.vec =</span> <span class="sc">~</span> psi),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">linpred=</span><span class="st">&quot;fitted&quot;</span>, <span class="at">data=</span>df</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>)</span></code></pre></div>
<p>The meaning of the arguments used is as follows:</p>
<ul>
<li>the first argument is a formula specifying the response variable and
the linear predictor to model the mean of the sampling distribution</li>
<li>the <code>family</code> argument allows to set one of a number of
sampling distributions and possibly pass additional family-dependent
arguments. In this case the scalar observation level variance parameter
is set to a fixed value 1, and unequal variances are set to the vector
<code>psi</code>.</li>
<li><code>linpred=&quot;fitted&quot;</code> indicates that we wish to obtain
samples from the posterior distribution for the vector <span class="math inline">\(\theta\)</span> of small area means.</li>
<li><code>data</code> is the <code>data.frame</code> in which variables
used in the model specification are looked up.</li>
</ul>
<p>An MCMC simulation using this sampler function is then carried out as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">MCMCsim</span>(sampler, <span class="at">store.all=</span><span class="cn">TRUE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>A summary of the results is obtained by</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>(summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim))</span></code></pre></div>
<pre><code>## llh_ :
##       Mean   SD t-value MCSE q0.05  q0.5 q0.95 n_eff R_hat
## llh_ -28.9 5.89   -4.91 0.13   -39 -28.6 -19.7  2038     1
## 
## linpred_ :
##    Mean    SD t-value    MCSE q0.05 q0.5 q0.95 n_eff R_hat
## 1  3.37 0.195   17.25 0.00356 3.052 3.37  3.70  3000 1.000
## 2  3.24 0.240   13.50 0.00438 2.844 3.24  3.62  2989 1.000
## 3  2.67 0.262   10.17 0.00479 2.239 2.66  3.10  3000 1.000
## 4  1.02 0.406    2.50 0.00751 0.353 1.02  1.70  2917 1.000
## 5  3.54 0.224   15.78 0.00409 3.172 3.54  3.90  3000 1.000
## 6  3.31 0.289   11.46 0.00540 2.827 3.32  3.78  2872 1.001
## 7  1.22 0.288    4.23 0.00558 0.741 1.22  1.68  2674 0.999
## 8  2.10 0.243    8.64 0.00444 1.709 2.10  2.50  3000 1.000
## 9  1.63 0.248    6.56 0.00453 1.218 1.63  2.04  3000 0.999
## 10 4.16 0.296   14.04 0.00553 3.679 4.16  4.65  2875 1.000
## ... 65 elements suppressed ...
## 
## beta :
##             Mean    SD t-value    MCSE q0.05 q0.5 q0.95 n_eff R_hat
## (Intercept) 1.01 0.149    6.79 0.00272 0.774 1.01  1.26  3000     1
## x           3.00 0.268   11.20 0.00489 2.558 3.01  3.45  3000     1
## 
## v_sigma :
##          Mean    SD t-value    MCSE q0.05  q0.5 q0.95 n_eff R_hat
## v_sigma 0.553 0.064    8.64 0.00145 0.453 0.549 0.663  1940  1.01
## 
## v :
##       Mean    SD t-value    MCSE    q0.05    q0.5  q0.95 n_eff R_hat
## 1   0.2966 0.213  1.3928 0.00389 -0.04317  0.2942 0.6505  3000 1.000
## 2  -0.3556 0.259 -1.3703 0.00474 -0.78753 -0.3515 0.0621  3000 1.000
## 3   0.4278 0.265  1.6121 0.00484 -0.00452  0.4253 0.8679  3000 1.000
## 4  -0.2907 0.407 -0.7149 0.00742 -0.96115 -0.2788 0.3823  3000 1.000
## 5   0.4800 0.237  2.0213 0.00434  0.09742  0.4814 0.8659  3000 1.000
## 6   0.0205 0.300  0.0685 0.00558 -0.47062  0.0282 0.5105  2881 1.001
## 7  -0.2350 0.300 -0.7846 0.00579 -0.73600 -0.2288 0.2556  2682 0.999
## 8  -0.3217 0.252 -1.2792 0.00459 -0.73526 -0.3223 0.0917  3000 1.000
## 9   0.5567 0.272  2.0449 0.00497  0.11805  0.5583 1.0033  3000 1.000
## 10  0.5895 0.308  1.9164 0.00570  0.09970  0.5876 1.1028  2917 1.000
## ... 65 elements suppressed ...</code></pre>
<p>In this example we can compare the model parameter estimates to the
‘true’ parameter values that have been used to generate the data. In the
next plots we compare the estimated and ‘true’ random effects, as well
as the model estimates and ‘true’ estimands. In the latter plot, the
original ‘direct’ estimates are added as red triangles.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">plot</span>(v, summ<span class="sc">$</span>v[, <span class="st">&quot;Mean&quot;</span>], <span class="at">xlab=</span><span class="st">&quot;true v&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;posterior mean&quot;</span>); <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">plot</span>(theta, summ<span class="sc">$</span>linpred_[, <span class="st">&quot;Mean&quot;</span>], <span class="at">xlab=</span><span class="st">&quot;true theta&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;estimated&quot;</span>); <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">points</span>(theta, df<span class="sc">$</span>y, <span class="at">col=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><img role="img" src="data:image/png;base64,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" /></p>
<p>We can compute model selection measures DIC and WAIC by</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">compute_DIC</span>(sim)</span></code></pre></div>
<pre><code>##      DIC    p_DIC 
## 109.5444  51.7866</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">compute_WAIC</span>(sim, <span class="at">show.progress=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##     WAIC1   p_WAIC1     WAIC2   p_WAIC2 
##  78.73590  20.98069 101.88097  32.55322</code></pre>
<p>Posterior means of residuals can be extracted from the simulation
output using method <code>residuals</code>. Here is a plot of (posterior
means of) residuals against covariate <span class="math inline">\(x\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>x, <span class="fu">residuals</span>(sim, <span class="at">mean.only=</span><span class="cn">TRUE</span>), <span class="at">xlab=</span><span class="st">&quot;x&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;residual&quot;</span>); <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>A linear predictor in a linear model can be expressed as a weighted
sum of the response variable. If we set
<code>compute.weights=TRUE</code> then such weights are computed for all
linear predictors specified in argument <code>linpred</code>. In this
case it means that a set of weights is computed for each area.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>sampler <span class="ot">&lt;-</span> <span class="fu">create_sampler</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  model,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">family=</span><span class="fu">f_gaussian</span>(<span class="at">var.prior=</span><span class="fu">pr_fixed</span>(<span class="dv">1</span>), <span class="at">var.vec =</span> <span class="sc">~</span> psi),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">linpred=</span><span class="st">&quot;fitted&quot;</span>, <span class="at">data=</span>df, <span class="at">compute.weights=</span><span class="cn">TRUE</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">MCMCsim</span>(sampler, <span class="at">store.all=</span><span class="cn">TRUE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Now the <code>weights</code> method returns a matrix of weights, in
this case a 75 <span class="math inline">\(\times\)</span> 75 matrix
<span class="math inline">\(w_{ij}\)</span> holding the weight of direct
estimate <span class="math inline">\(i\)</span> in linear predictor
<span class="math inline">\(j\)</span>. To verify that the weights
applied to the direct estimates yield the model-based estimates we plot
them against each other. Also shown is a plot of the weight of the
direct estimate for each area in the predictor for that same area,
against the variance of the direct estimate.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">plot</span>(summ<span class="sc">$</span>linpred_[, <span class="st">&quot;Mean&quot;</span>], <span class="fu">crossprod</span>(<span class="fu">weights</span>(sim), df<span class="sc">$</span>y),</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;estimate&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;weighted average&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="fu">plot</span>(psi, <span class="fu">diag</span>(<span class="fu">weights</span>(sim)), <span class="at">ylab=</span><span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><img role="img" src="data:image/png;base64,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" /></p>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Fay1979" class="csl-entry">
Fay, R. E., and R. A. Herriot. 1979. <span>“Estimates of Income for
Small Places: An Application of James-Stein Procedures to Census
Data.”</span> <em>Journal of the American Statistical Association</em>
74 (366): 269–77.
</div>
<div id="ref-rao2015small" class="csl-entry">
Rao, J. N. K., and I. Molina. 2015. <em>Small Area Estimation</em>. John
Wiley &amp; Sons.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
